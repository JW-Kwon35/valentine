<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Will you be my Valentine?</title>
  <style>
    :root{
      --bg1:#ff9a9e;
      --bg2:#fad0c4;
      --card:#ffffffcc;
      --text:#2b2b2b;
      --shadow: 0 20px 60px rgba(0,0,0,.18);
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      min-height:100vh;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      overflow:hidden;
      background:
        radial-gradient(1200px 700px at 20% 10%, rgba(255,255,255,.55), transparent 55%),
        radial-gradient(1000px 700px at 80% 20%, rgba(255,255,255,.45), transparent 60%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
      display:grid;
      place-items:center;
      padding:24px;
    }

    /* subtle floating hearts in background */
    .bg-heart{
      position:fixed;
      top:110vh;
      left:0;
      font-size:18px;
      opacity:.18;
      filter: blur(.1px);
      animation: floatUp linear forwards;
      pointer-events:none;
      user-select:none;
    }
    @keyframes floatUp{
      from { transform: translateY(0) translateX(0) rotate(0deg); }
      to   { transform: translateY(-140vh) translateX(var(--drift)) rotate(18deg); }
    }

    main.card{
      width:min(520px, 92vw);
      background:var(--card);
      border:1px solid rgba(255,255,255,.55);
      backdrop-filter: blur(10px);
      border-radius:26px;
      box-shadow:var(--shadow);
      padding:28px 22px;
      text-align:center;
      position:relative;
    }

    .badge{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding:8px 12px;
      border-radius:999px;
      background:rgba(255,255,255,.7);
      border:1px solid rgba(0,0,0,.06);
      font-size:13px;
      margin-bottom:14px;
    }

    h1{
      margin:8px 0 8px;
      font-size:clamp(26px, 4.5vw, 38px);
      line-height:1.15;
      letter-spacing:-.02em;
    }
    p#subtitle{
      margin:0 auto 18px;
      font-size:15px;
      line-height:1.5;
      opacity:.92;
      max-width:42ch;
      min-height:48px;
    }

    .buttons{
      position:relative;
      display:flex;
      justify-content:center;
      gap:12px;
      padding:14px 0 6px;
      min-height:64px;
    }
    button{
      border:0;
      cursor:pointer;
      border-radius:16px;
      padding:14px 18px;
      font-weight:800;
      font-size:16px;
      box-shadow: 0 10px 20px rgba(0,0,0,.12);
      transition: transform .12s ease, box-shadow .12s ease, filter .12s ease;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    button:active{ transform: translateY(1px) scale(.99); }

    #yesBtn{
      background: linear-gradient(180deg, #ff4d6d, #ff2d55);
      color:white;
      transform: scale(1);
    }
    #yesBtn:hover{ filter: brightness(1.02); }

    #noBtn{
      background: rgba(255,255,255,.9);
      color:#1f1f1f;
      border:1px solid rgba(0,0,0,.08);
      position:relative; /* will switch to fixed when it starts running */
    }

    .row{
      display:flex;
      justify-content:center;
      gap:10px;
      flex-wrap:wrap;
      margin-top:10px;
    }
    .secondary{
      background: rgba(255,255,255,.75);
      border:1px solid rgba(0,0,0,.08);
      color:#333;
      box-shadow:none;
      font-weight:700;
      padding:10px 14px;
      border-radius:14px;
      font-size:14px;
    }

    /* celebration overlay */
    .overlay{
      position:fixed;
      inset:0;
      display:none;
      place-items:center;
      background: rgba(0,0,0,.18);
      backdrop-filter: blur(5px);
      z-index:50;
      padding:22px;
    }
    .overlay.show{ display:grid; }
    .modal{
      width:min(520px, 92vw);
      background: rgba(255,255,255,.92);
      border-radius:26px;
      box-shadow: var(--shadow);
      padding:26px 20px;
      text-align:center;
      border:1px solid rgba(0,0,0,.06);
    }
    .modal h2{
      margin:8px 0 6px;
      font-size:clamp(22px, 4vw, 30px);
    }
    .modal p{
      margin:0 auto 14px;
      opacity:.9;
      line-height:1.6;
      max-width:46ch;
    }

    /* confetti hearts */
    .confetti{
      position:fixed;
      top:-30px;
      left:0;
      pointer-events:none;
      user-select:none;
      animation: fall var(--dur) linear forwards;
      transform: translateX(var(--x)) rotate(var(--rot));
      font-size: var(--size);
      opacity: var(--op);
      z-index:60;
      filter: drop-shadow(0 6px 10px rgba(0,0,0,.12));
    }
    @keyframes fall{
      to { top:110vh; transform: translateX(var(--x)) rotate(calc(var(--rot) + 25deg)); }
    }

    /* tiny footer note */
    .note{
      margin-top:10px;
      font-size:12px;
      opacity:.72;
    }

    @media (max-width: 380px){
      button{ padding:13px 14px; }
      .buttons{ gap:10px; }
    }
  </style>
</head>
<body>
  <main class="card" aria-live="polite">
    <div class="badge">ğŸ’Œ <span id="badgeText">valentine mode</span></div>
    <h1 id="title">Will you be my Valentine? ğŸ’˜</h1>
    <p id="subtitle">ëŒ€ë‹µì€â€¦ Yes ì•„ë‹ˆë©´ No! (ê·¼ë° NoëŠ” ì¢€ ë¶€ë„ëŸ¼ì´ ë§ì•„ ğŸƒâ€â™‚ï¸)</p>

    <div class="buttons" id="btnArea">
      <button id="yesBtn" type="button">Yes ğŸ’—</button>
      <button id="noBtn" type="button">No ğŸ™ˆ</button>
    </div>

    <div class="row">
      <button class="secondary" id="copyBtn" type="button">ğŸ”— ë§í¬ ë³µì‚¬</button>
      <button class="secondary" id="resetBtn" type="button">â†©ï¸ ë¦¬ì…‹</button>
    </div>

    <div class="note">* ì¥ë‚œì€ ì¥ë‚œìœ¼ë¡œ! ì¶©ë¶„íˆ ì¹œí•œ ì‚¬ì´ì—ë§Œ ğŸ˜‡</div>
  </main>

  <div class="overlay" id="overlay" role="dialog" aria-modal="true">
    <div class="modal">
      <div style="font-size:42px; line-height:1;">ğŸ’–</div>
      <h2 id="modalTitle">Yay!!!</h2>
      <p id="modalText">ì˜¬í•´ ë°œë Œíƒ€ì¸ì€ ìš°ë¦¬ ê±°ë‹¤ ğŸ¥°</p>
      <div class="row">
        <button id="closeBtn" type="button">ë‹«ê¸°</button>
        <button class="secondary" id="copyBtn2" type="button">ğŸ”— ë§í¬ ë³µì‚¬</button>
      </div>
    </div>
  </div>

  <script>
    // --- Personalization via query params ---
    // Example: index.html?to=ë¯¼ì§€&from=ì¤€í˜¸
    const params = new URLSearchParams(location.search);
    const toName = (params.get("to") || params.get("name") || "").trim();
    const fromName = (params.get("from") || "").trim();

    const titleEl = document.getElementById("title");
    const badgeEl = document.getElementById("badgeText");
    if (toName && fromName){
      titleEl.textContent = `${toName}ì•„(ì•¼), ${fromName}ì˜ ë°œë Œíƒ€ì¸ì´ ë˜ì–´ì¤„ë˜? ğŸ’˜`;
      badgeEl.textContent = `to ${toName} Â· from ${fromName}`;
    } else if (toName){
      titleEl.textContent = `${toName}ì•„(ì•¼), ë‚´ ë°œë Œíƒ€ì¸ì´ ë˜ì–´ì¤„ë˜? ğŸ’˜`;
      badgeEl.textContent = `to ${toName}`;
    } else {
      badgeEl.textContent = `shareable link inside`;
    }

    const subtitle = document.getElementById("subtitle");
    const yesBtn = document.getElementById("yesBtn");
    const noBtn  = document.getElementById("noBtn");
    const overlay = document.getElementById("overlay");
    const modalTitle = document.getElementById("modalTitle");
    const modalText  = document.getElementById("modalText");
    const closeBtn = document.getElementById("closeBtn");
    const copyBtn = document.getElementById("copyBtn");
    const copyBtn2 = document.getElementById("copyBtn2");
    const resetBtn = document.getElementById("resetBtn");

    let noAttempts = 0;
    const MAX_NO = 10;
    let noIsRunning = true;

    // "No" ë²„íŠ¼ì´ í™”ë©´ ë°–ìœ¼ë¡œ ì‚¬ë¼ì§€ëŠ” ë¬¸ì œë¥¼ ë§‰ê¸° ìœ„í•´,
    // í•œë²ˆì´ë¼ë„ ë„ë§ì¹˜ê¸° ì‹œì‘í•˜ë©´ ë²„íŠ¼ì„ <body>ë¡œ ì ê¹ ì˜®ê²¨ì„œ(fixed) ì›€ì§ì…ë‹ˆë‹¤.
    const btnArea = document.getElementById("btnArea");
    let noDetached = false;
    const noSlot = document.createElement("span"); // ì›ë˜ ìë¦¬ ìœ ì§€ìš© placeholder

    const lines = [
      "ì§„ì§œë¡œ Noâ€¦? ğŸ¥º",
      "í•œ ë²ˆë§Œ ë” ìƒê°í•´ì£¼ë©´ ì•ˆ ë¼? ğŸ’—",
      "ë‚´ê°€ ê°„ì‹ ì‚¬ì¤„ê²Œâ€¦ ğŸ«",
      "ì—¬ê¸°ê¹Œì§€ ì™”ëŠ”ë°â€¦ ì œë°œâ€¦ ğŸ™",
      "ì‹¬ì¥ì´ ìª¼ê°œì§€ëŠ” ì¤‘â€¦ ğŸ’”",
      "ì˜¤ì¼€ì´â€¦ ê·¸ë˜ë„ ë‚œ í¬ê¸° ëª» í•´â€¦ ğŸ˜¤",
      "ì¡°ê¸ˆë§Œ ë”! (7ë²ˆì§¸ì•¼) ğŸ«£",
      "ì´ê±´ ê±°ì˜ ìš´ëª…ì´ì•¼â€¦ (8ë²ˆì§¸) ğŸ§²",
      "ì§„ì§œ ë§ˆì§€ë§‰ ì§ì „â€¦ (9ë²ˆì§¸) ğŸ˜³",
      "ë¼ìŠ¤íŠ¸! ì§„ì§œ ë¼ìŠ¤íŠ¸! (10ë²ˆì§¸) ğŸ¥¹",
    ];

    function clamp(n, min, max){ return Math.max(min, Math.min(max, n)); }

    function setYesScale(){
      const s = clamp(1 + noAttempts * 0.12, 1, 1.9);
      yesBtn.style.transform = `scale(${s})`;
      yesBtn.style.boxShadow = `0 ${10 + s*3}px ${20 + s*10}px rgba(0,0,0,.14)`;
    }

    function detachNoIfNeeded(){
      if (noDetached) return;

      const rect = noBtn.getBoundingClientRect();
      // placeholder í¬ê¸° ê³ ì • (ë ˆì´ì•„ì›ƒ ìœ ì§€)
      noSlot.style.display = "inline-block";
      noSlot.style.width = rect.width + "px";
      noSlot.style.height = rect.height + "px";

      // noBtnì„ placeholderë¡œ êµì²´ í›„ bodyë¡œ ì´ë™
      btnArea.replaceChild(noSlot, noBtn);
      document.body.appendChild(noBtn);

      noBtn.style.position = "fixed";
      noBtn.style.left = rect.left + "px";
      noBtn.style.top  = rect.top + "px";
      noBtn.style.margin = "0";
      noBtn.style.zIndex = "40";

      noDetached = true;
    }

    function restoreNoToButtons(){
      if (!noDetached) return;

      // ì›ë˜ ìë¦¬ë¡œ ë³µê·€
      btnArea.replaceChild(noBtn, noSlot);

      // ìŠ¤íƒ€ì¼ ì´ˆê¸°í™”
      noBtn.style.position = "relative";
      noBtn.style.left = "";
      noBtn.style.top  = "";
      noBtn.style.margin = "";
      noBtn.style.zIndex = "";

      noDetached = false;
    }

    function moveNoButton(){
      if (!noIsRunning) return;

      detachNoIfNeeded();

      // iOS ì£¼ì†Œì°½(visualViewport) ë³€ë™ì—ë„ í™”ë©´ ì•ˆìª½ì—ë§Œ ë¨¸ë¬´ë¥´ê²Œ
      const rect = noBtn.getBoundingClientRect();
      const vv = window.visualViewport;
      const vw = vv ? vv.width : window.innerWidth;
      const vh = vv ? vv.height : window.innerHeight;
      const ox = vv ? vv.offsetLeft : 0;
      const oy = vv ? vv.offsetTop  : 0;

      const padding = 12;
      const minX = ox + padding;
      const minY = oy + padding;
      const maxX = ox + vw - rect.width  - padding;
      const maxY = oy + vh - rect.height - padding;

      const x = (maxX <= minX) ? minX : (Math.random() * (maxX - minX) + minX);
      const y = (maxY <= minY) ? minY : (Math.random() * (maxY - minY) + minY);

      noBtn.style.left = x + "px";
      noBtn.style.top  = y + "px";
    }

    function backgroundHearts(){
      const emojis = ["ğŸ’—","ğŸ’–","ğŸ’˜","ğŸ’•","â¤ï¸"];
      const heart = document.createElement("div");
      heart.className = "bg-heart";
      heart.textContent = emojis[Math.floor(Math.random()*emojis.length)];
      const x = Math.random() * 100;
      heart.style.left = x + "vw";
      heart.style.setProperty("--drift", (Math.random()*40 - 20) + "vw");
      heart.style.animationDuration = (8 + Math.random()*8) + "s";
      heart.style.fontSize = (14 + Math.random()*18) + "px";
      document.body.appendChild(heart);
      setTimeout(() => heart.remove(), 17000);
    }
    setInterval(backgroundHearts, 700);

    function confettiHearts(count=42){
      const emojis = ["ğŸ’—","ğŸ’–","ğŸ’˜","ğŸ’•","â¤ï¸"];
      for (let i=0; i<count; i++){
        const c = document.createElement("div");
        c.className = "confetti";
        c.textContent = emojis[Math.floor(Math.random()*emojis.length)];
        const x = Math.random() * 100;
        const dur = 2.8 + Math.random()*2.6;
        const size = (16 + Math.random()*26) + "px";
        const rot = (Math.random()*60 - 30) + "deg";
        const op = (0.65 + Math.random()*0.35).toFixed(2);

        c.style.setProperty("--x", x + "vw");
        c.style.setProperty("--dur", dur + "s");
        c.style.setProperty("--size", size);
        c.style.setProperty("--rot", rot);
        c.style.setProperty("--op", op);

        document.body.appendChild(c);
        setTimeout(() => c.remove(), (dur*1000) + 400);
      }
    }

    function showYes(){
      const who = toName || "ë„ˆ";
      overlay.classList.add("show");
      modalTitle.textContent = "Yay!!! ğŸ’";
      modalText.textContent = `${who}ë‘ í•¨ê»˜ë¼ì„œ ì™„ì „ í–‰ë³µí•´ ğŸ¥°`;
      confettiHearts(55);
    }

    function showNo(){
      const who = toName || "ë„ˆ";
      overlay.classList.add("show");
      modalTitle.textContent = "ì•Œê² ì–´ ğŸ˜Œ";
      modalText.textContent = `${who}ì˜ ë§ˆìŒë„ ì¡´ì¤‘í• ê²Œ. ê·¸ë˜ë„ ê³ ë§ˆì›Œ!`;
    }

    // --- Viral interactions ---
    // iOSì—ì„œ "pointerdownìœ¼ë¡œ ë¨¼ì € ì›€ì§ì—¬ì„œ í´ë¦­ì´ ì•ˆ ë˜ëŠ”" í˜„ìƒì„ í”¼í•˜ë ¤ê³ ,
    // No ë²„íŠ¼ì€ "í´ë¦­ ì„±ê³µ í›„"ì—ë§Œ ë„ë§ê°€ê²Œ ì²˜ë¦¬í•©ë‹ˆë‹¤. (ê·¸ë˜ì„œ 10ë²ˆì€ í™•ì‹¤íˆ ëˆ„ë¥¼ ìˆ˜ ìˆìŒ)
    function handleNoClick(){
      // 10ë²ˆ ë‹¤ ëˆ„ë¥¸ ë’¤ì—ëŠ” 'ì§„ì§œ No' ì²˜ë¦¬
      if (!noIsRunning && noAttempts >= MAX_NO){
        showNo();
        return;
      }

      // 1~10ë²ˆì§¸ê¹Œì§€ ì¹´ìš´íŠ¸
      noAttempts = Math.min(noAttempts + 1, MAX_NO);
      subtitle.textContent = lines[Math.min(noAttempts - 1, lines.length - 1)];
      setYesScale();

      if (noAttempts >= MAX_NO){
        noIsRunning = false;
        subtitle.textContent = "ì˜¤ì¼€ì´. No 10ë²ˆì´ë©´ ì¸ì •! (ì´ì œ No ë²„íŠ¼ ì•ˆ ë„ë§ê°) ğŸ™‚";
        restoreNoToButtons();
        return;
      }

      moveNoButton();
    }

    noBtn.addEventListener("click", handleNoClick);
    yesBtn.addEventListener("click", showYes);
function buildShareURL(){
      const url = new URL(location.href);
      if (toName) url.searchParams.set("to", toName);
      if (fromName) url.searchParams.set("from", fromName);
      return url.toString();
    }

    async function copyLink(){
      const shareUrl = buildShareURL();
      try{
        await navigator.clipboard.writeText(shareUrl);
        subtitle.textContent = "ë§í¬ ë³µì‚¬ ì™„ë£Œ! ì´ì œ ê·¸ ì‚¬ëŒì—ê²Œ ë³´ë‚´ë©´ ë¨ ğŸ˜";
      }catch{
        // fallback prompt
        window.prompt("ë³µì‚¬í•´ì„œ ë³´ë‚´ê¸°:", shareUrl);
      }
    }

    copyBtn.addEventListener("click", copyLink);
    copyBtn2.addEventListener("click", copyLink);

    closeBtn.addEventListener("click", () => overlay.classList.remove("show"));
    overlay.addEventListener("click", (e) => {
      if (e.target === overlay) overlay.classList.remove("show");
    });

    resetBtn.addEventListener("click", () => {
      noAttempts = 0;
      noIsRunning = true;

      // No ë²„íŠ¼ì´ í™”ë©´ ì–´ë”˜ê°€ë¡œ ë– ìˆë˜ ìƒíƒœë©´ ì›ë˜ ìë¦¬ë¡œ ëŒë ¤ë†“ê¸°
      restoreNoToButtons();

      yesBtn.style.transform = "scale(1)";
      yesBtn.style.boxShadow = "";
      subtitle.textContent = "ëŒ€ë‹µì€â€¦ Yes ì•„ë‹ˆë©´ No! (ê·¼ë° NoëŠ” ì¢€ ë¶€ë„ëŸ¼ì´ ë§ì•„ ğŸƒâ€â™‚ï¸)";
    });

    // Optional: if they explicitly type ?forceNo=1 to allow no immediately
    if (params.get("forceNo") === "1"){
      // ì¦‰ì‹œ "No"ë¥¼ í—ˆìš©: No ë²„íŠ¼ì€ ë„ë§ê°€ì§€ ì•ŠìŒ + ëˆ„ë¥´ë©´ ë°”ë¡œ showNo()
      noIsRunning = false;
      noAttempts = MAX_NO;
      restoreNoToButtons();
      subtitle.textContent = "Noë„ ê°€ëŠ¥! (forceNo=1)";
    }
  </script>
</body>
</html>
